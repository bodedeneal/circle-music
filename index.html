<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Gravity Ball â€“ YouTube Short</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  html, body {
    margin: 0;
    padding: 0;
    background: #000;
    font-family: sans-serif;
    color: white;
    text-align: center;
  }
  h2 {
    font-size: 32px;
    margin: 20px 0 10px;
    font-weight: bold;
  }
  canvas {
    display: block;
    margin: 0 auto;
    border: 2px solid #fff;
    border-radius: 12px;
    background: #000;
  }
  .controls {
    margin: 16px 0;
  }
  button {
    padding: 10px 20px;
    font-size: 16px;
    margin: 0 8px;
    cursor: pointer;
  }
  input[type="file"] {
    margin-top: 10px;
  }
</style>
</head>
<body>

<h2>Watch What Will Happen</h2>
<canvas id="canvas" width="640" height="640"></canvas>

<div class="controls">
  <button id="startBtn">Start</button>
  <button id="resetBtn">Reset</button>
  <input type="file" id="audioFile" accept="audio/*">
</div>

<audio id="audio" preload="auto" style="display:none"></audio>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const startBtn = document.getElementById('startBtn');
const resetBtn = document.getElementById('resetBtn');
const audioInput = document.getElementById('audioFile');
const audio = document.getElementById('audio');

let x = canvas.width / 2;
let y = canvas.height / 2;
let vx = 200;
let vy = 150;
let radius = 20;
let gravity = 500;
let elasticity = 1.019;
let running = false;
let recorder, recordedChunks = [];
let startTime = 0;
let trail = [];

const VIDEO_DURATION = 60000; // 60 seconds
const GROWTH_RATE = 100 / 45; // 100px over 45s (faster than video length)

audioInput.addEventListener('change', () => {
  const file = audioInput.files[0];
  if (file) {
    const url = URL.createObjectURL(file);
    audio.src = url;
    audio.load();
  }
});

function resetBall() {
  x = canvas.width / 2;
  y = canvas.height / 2;
  vx = (Math.random() - 0.5) * 400;
  vy = (Math.random() - 0.5) * 400;
  radius = 20;
  trail = [];
}

function drawBall() {
  ctx.fillStyle = '#000';
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  for (const t of trail) {
    ctx.beginPath();
    ctx.arc(t.x, t.y, t.r, 0, Math.PI * 2);
    ctx.fillStyle = 'rgba(255,255,255,0.1)';
    ctx.fill();
  }

  ctx.beginPath();
  ctx.arc(x, y, radius, 0, Math.PI * 2);
  ctx.fillStyle = '#fff';
  ctx.fill();
}

function reflect(vx, vy, nx, ny) {
  const dot = vx * nx + vy * ny;
  return [(vx - 2 * dot * nx) * elasticity, (vy - 2 * dot * ny) * elasticity];
}

function animate(timestamp) {
  if (!startTime) startTime = timestamp;
  const elapsed = (timestamp - startTime) / 1000;
  const dt = 1 / 60;

  radius = 20 + elapsed * GROWTH_RATE;

  vy += gravity * dt;
  x += vx * dt;
  y += vy * dt;

  trail.push({ x, y, r: radius });
  if (trail.length > 30) trail.shift();

  const dx = x - canvas.width / 2;
  const dy = y - canvas.height / 2;
  const dist = Math.hypot(dx, dy);
  const maxDist = canvas.width / 2 - radius;

  if (dist >= maxDist) {
    const nx = dx / dist;
    const ny = dy / dist;
    x = canvas.width / 2 + nx * maxDist;
    y = canvas.height / 2 + ny * maxDist;
    [vx, vy] = reflect(vx, vy, nx, ny);
  }

  drawBall();
  if (running) requestAnimationFrame(animate);
}

startBtn.addEventListener('click', () => {
  startBtn.disabled = true;
  setTimeout(() => {
    resetBall();
    running = true;
    startTime = 0;
    if (audio.src) audio.play();

    const stream = canvas.captureStream(60);
    recorder = new MediaRecorder(stream, { mimeType: 'video/webm' });
    recordedChunks = [];

    recorder.ondataavailable = e => {
      if (e.data.size > 0) recordedChunks.push(e.data);
    };

    recorder.onstop = () => {
      const blob = new Blob(recordedChunks, { type: 'video/webm' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'gravity-ball-short.webm';
      a.click();
      URL.revokeObjectURL(url);
    };

    recorder.start();
    requestAnimationFrame(animate);

    setTimeout(() => {
      recorder.stop();
      running = false;
      startBtn.disabled = false;
      if (!audio.paused) audio.pause();
    }, VIDEO_DURATION);
  }, 1000);
});

resetBtn.addEventListener('click', () => {
  running = false;
  startBtn.disabled = false;
  if (!audio.paused) audio.pause();
  resetBall();
  drawBall();
});

resetBall();
drawBall();
</script>
</body>
</html>
